<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Import Excel â†’ Grist</title>

    <!-- Feuilles de style -->
    <link rel="stylesheet" href="/styles/style.css" />
  </head>

  <body>
    <div class="container">
      <!-- ğŸ”§ SÃ©lecteur de mode -->
      <div class="mode-selector" style="text-align: right; margin-bottom: 1rem">
        <label for="mode-selector">ğŸ› ï¸ Mode :</label>
        <select id="mode-selector">
          <option value="public" selected>Public (utilisateur)</option>
          <option value="admin">Admin (rÃ¨gles Grist)</option>
          <option value="dev">DÃ©veloppement</option>
        </select>
      </div>

      <h1>ğŸ“¥ Import Excel â†’ Grist</h1>

      <!-- ğŸ“ Ã‰tape 1 : Chargement du fichier Excel -->
      <section class="card" data-mode="public dev">
        <h2>1. Charger un fichier Excel</h2>
        <input type="file" id="file-input" accept=".xlsx" />
        <p id="file-name" class="text-gray"></p>
      </section>

      <!-- ğŸ‘€ Ã‰tape 2 : PrÃ©visualisation des donnÃ©es -->
      <section class="card" data-mode="dev">
        <h2>2. PrÃ©visualisation des donnÃ©es Excel</h2>
        <div id="preview-container">
          <div class="table-wrapper"></div>
        </div>

        <!-- ğŸ”½ Liste des colonnes Excel dÃ©tectÃ©es -->
        <div style="margin-top: 1rem">
          <label for="column-list">Colonnes Excel dÃ©tectÃ©es :</label><br />
          <select
            id="column-list"
            style="width: 100%; margin-top: 0.5rem"
          ></select>
        </div>
      </section>

      <!-- âš™ï¸ Ã‰tape 3 : RÃ¨gles de correspondance -->
      <section class="card" data-mode="admin dev">
        <h2>3. Configuration des rÃ¨gles d'import</h2>
        <p>Choisis une rÃ¨gle pour chaque champ importÃ© :</p>
        <div id="grist-rules-table" class="rules-grid"></div>
        <button id="save-rules-btn" class="mt-4">
          ğŸ’¾ Sauvegarder les rÃ¨gles
        </button>
      </section>

      <!-- ğŸ”‘ Ã‰tape 4 : ClÃ© de doublon -->
      <section class="card" data-mode="admin dev">
        <h2>4. ClÃ© unique pour les doublons</h2>
        <p>SÃ©lectionne la colonne servant d'identifiant unique :</p>
        <select
          id="unique-key-dropdown"
          style="width: 100%; margin-top: 0.5rem"
        ></select>
      </section>

      <!-- ğŸš€ Ã‰tape 5 : Mapping & import -->
      <section class="card" data-mode="public dev">
        <h2>5. Lancement de l'import</h2>

        <button id="match-columns-button" style="margin-top: 1rem">
          ğŸ” Faire correspondre les colonnes Excel â†” Grist
        </button>

        <div id="mapping-preview" class="mt-2"></div>

        <button id="launch-import-btn" class="mt-4">ğŸš€ Lancer l'import</button>

        <p id="import-status" class="mt-2"></p>
      </section>
    </div>

    <!-- ğŸ“¦ Scripts -->
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
